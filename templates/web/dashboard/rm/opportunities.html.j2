{%extends 'web/rm-base-dashboard.html.j2'%}
{% block title %} Opportunities | Blinkx{% endblock %}
{%block custom_css%}
<style>
.oppTabsList{
    display: flex;
}

.oppTabsList .nav-link{
    font-size: 14px;
    padding: 1rem 0.877rem;
    border-radius: 5px 5px 0 0;
    border: none;
}
.nav-tabs .nav-link.active, .nav-tabs .nav-item.show .nav-link, .nav-tabs .nav-link:focus{
    background: linear-gradient(144.07deg, #EC590C -8.68%, #C027D2 135.39%);
    color: #fff;
    border: #EC590C;
}
.totals span{
    color: #000;
}
table.dataTable thead .sorting:before, table.dataTable thead .sorting:after, table.dataTable thead .sorting_asc:before, table.dataTable thead .sorting_asc:after, table.dataTable thead .sorting_desc:before, table.dataTable thead .sorting_desc:after, table.dataTable thead .sorting_asc_disabled:before, table.dataTable thead .sorting_asc_disabled:after, table.dataTable thead .sorting_desc_disabled:before, table.dataTable thead .sorting_desc_disabled:after{
    bottom:1.3rem !important;
}
@media screen and (max-width: 768px){
    .oppTabsList .nav-link {
        font-size: 12px;
        padding: 0.6rem 0.4rem;
    }
}
</style>
{%endblock%}
{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/css/nice-select.min.css"
    integrity="sha512-CruCP+TD3yXzlvvijET8wV5WxxEh5H8P4cmz0RFbKK6FlZ2sYl3AEsKlLPHbniXKSrDdFewhbmBK5skbdsASbQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<!-- Content Wrapper -->
<div id="content-wrapper" class="d-flex flex-column">

    <!-- Main Content -->
    <div id="content">

        <!-- Topbar -->
        <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top py-5 justify-content-between">

            <!-- Sidebar Toggle (Topbar) -->
<!-- deleted -->

            <!-- Topbar Search -->
            <div class="top-heading">
                <p class="h3 font-weight-600">Opportunities</p>

            </div>
            {%include 'web/dashboard/_partials/rm/header.html.j2'%}

        </nav>
        <!-- End of Topbar -->

        <!-- Begin Page Content -->
        <div class="container-fluid">
            <div class="row">
                <div class="col-12 col-xl-12 col-lg-12">
                    <ul class="nav nav-tabs oppTabsList" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="lead-tab" data-toggle="tab" data-target="#lead" type="button" role="tab" aria-controls="lead" aria-selected="true">Referrals Generation</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="account-tab" data-toggle="tab" data-target="#account" type="button" role="tab" aria-controls="account" aria-selected="false">Account Activation</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="brokerage-tab" data-toggle="tab" data-target="#brokerage" type="button" role="tab" aria-controls="brokerage" aria-selected="false">Brokerage Generation</button>
                        </li>
                        <!-- <li class="nav-item" role="presentation">
                            <button class="nav-link" id="downfall-tab" data-toggle="tab" data-target="#downfall" type="button" role="tab" aria-controls="downfall" aria-selected="false">Downfall Account Activation</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="gross-tab" data-toggle="tab" data-target="#gross" type="button" role="tab" aria-controls="gross" aria-selected="false">Downfall Gross Brokerage Generated</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="growth-tab" data-toggle="tab" data-target="#growth" type="button" role="tab" aria-controls="growth" aria-selected="false">De-growth Leads</button>
                        </li> -->
                    </ul>
                    <div class="tab-content mt-4" id="oppTabsContent">
                        <div class="tab-pane active" id="lead" role="tabpanel" aria-labelledby="lead-tab">
                            <div class="card border-0 mb-4">
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table dataTable-lead" id="dataTable" width="100%" cellspacing="0">
                                            <thead class="bg-beige">
                                                <tr class="">
                                                    <th>DRA Code</th>
                                                    <th>DRA Name</th>
                                                    <th>Oct - 22</th>
                                                    <th>Nov - 22</th>
                                                    <th>Dec - 22</th>
                                                    <th>Total Account Activated</th>
                                                    <th>Average of Quarter</th>
                                                </tr>
                                            </thead>
                                            <tbody class="" data-lead-generation>
                                            </tbody>
                                            <tfoot class="">
                                                <tr class="totals">
                                                    <td colspan="2"><span>Total accounts activated:</span></td>
                                                    <td><span class="octTotalSum"></span></td>
                                                    <td><span class="novTotalSum"></span></td>
                                                    <td><span class="decTotalSum"></span></td>
                                                    <td><span class="activatedTotalSum"></span></td>
                                                    <td><span class="avgTotalSum"></span></td>
                                                </tr>
                                            </tfoot>
                                        </table>

                                        <div data-empty-category="" style="display: none;" class="card w-100 mt-4">
                                            <p class="h6 text-center py-5">No Data Available</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="account" role="tabpanel" aria-labelledby="account-tab">
                            <div class="card border-0 mb-4">
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table dataTable-account" id="dataTable" width="100%" cellspacing="0">
                                            <thead class="bg-beige">
                                                <tr class=" ">
                                                    <th>DRA Code</th>
                                                    <th>DRA Name</th>
                                                    <th>Oct - 22</th>
                                                    <th>Nov - 22</th>
                                                    <th>Dec - 22</th>
                                                    <th>Total Brokerage Genarated</th>
                                                    <th>Average of Quarter</th>
                                                </tr>
                                            </thead>
                                            <tbody class=" " data-account>
                                            </tbody>
                                            <tfoot class=" ">
                                                <tr class="totals">
                                                    <td colspan="2"><span>Total accounts activated:</span></td>
                                                    <td><span class="octTotalSum"></span></td>
                                                    <td><span class="novTotalSum"></span></td>
                                                    <td><span class="decTotalSum"></span></td>
                                                    <td><span class="activatedTotalSum"></span></td>
                                                    <td><span class="avgTotalSum"></span></td>
                                                </tr>
                                            </tfoot>
                                        </table>

                                        <div data-empty-category="" style="display: none;" class="card w-100 mt-4">
                                            <p class="h6 text-center py-5">No Data Available</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="brokerage" role="tabpanel" aria-labelledby="brokerage-tab">
                            <div class="card border-0 mb-4">
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table dataTable-brokerage" id="dataTable" width="100%" cellspacing="0">
                                            <thead class="bg-beige">
                                                <tr class=" ">
                                                    <th>DRA Code</th>
                                                    <th>DRA Name</th>
                                                    <th>Oct - 22</th>
                                                    <th>Nov - 22</th>
                                                    <th>Dec - 22</th>
                                                    <th>Total Referrals Genarated</th>
                                                    <th>Average of Quarter</th>
                                                </tr>
                                            </thead>
                                            <tbody class=" " data-brokerage>
                                            </tbody>
                                            <tfoot class=" ">
                                                <tr class="totals">
                                                    <td colspan="2"><span>Total accounts activated:</span></td>
                                                    <td><span class="octTotalSum"></span></td>
                                                    <td><span class="novTotalSum"></span></td>
                                                    <td><span class="decTotalSum"></span></td>
                                                    <td><span class="activatedTotalSum"></span></td>
                                                    <td><span class="avgTotalSum"></span></td>
                                                </tr>
                                            </tfoot>
                                        </table>

                                        <div data-empty-category="" style="display: none;" class="card w-100 mt-4">
                                            <p class="h6 text-center py-5">No Data Available</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="downfall" role="tabpanel" aria-labelledby="downfall-tab">
                            <div class="card border-0 mb-4">
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table" id="dataTable" width="100%" cellspacing="0">
                                            <thead class="bg-beige">
                                                <tr class=" ">
                                                    <th>DRA Code</th>
                                                    <th>DRA Name</th>
                                                    <th>Oct - 22</th>
                                                    <th>Nov - 22</th>
                                                    <th>Dec - 22</th>
                                                    <th>Total Account Activated</th>
                                                    <th>Average of Quarter</th>
                                                </tr>
                                            </thead>
                                            <tbody class=" " data-downfall>
                                            </tbody>
                                            <tfoot class=" ">
                                                <tr class="totals">
                                                    <td colspan="2"><span>Total accounts activated:</span></td>
                                                    <td><span class="octTotalSum"></span></td>
                                                    <td><span class="novTotalSum"></span></td>
                                                    <td><span class="decTotalSum"></span></td>
                                                    <td><span class="activatedTotalSum"></span></td>
                                                    <td><span class="avgTotalSum"></span></td>
                                                </tr>
                                            </tfoot>
                                        </table>

                                        <div data-empty-category="" style="display: none;" class="card w-100 mt-4">
                                            <p class="h6 text-center py-5">No Data Available</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="gross" role="tabpanel" aria-labelledby="gross-tab">
                            <div class="card border-0 mb-4">
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table" id="dataTable" width="100%" cellspacing="0">
                                            <thead class="bg-beige">
                                                <tr class=" ">
                                                    <th>DRA Code</th>
                                                    <th>DRA Name</th>
                                                    <th>Oct - 22</th>
                                                    <th>Nov - 22</th>
                                                    <th>Dec - 22</th>
                                                    <th>Total Brokerage Generated</th>
                                                    <th>Average of Quarter</th>
                                                </tr>
                                            </thead>
                                            <tbody class=" " data-gross>
                                            </tbody>
                                            <tfoot class=" ">
                                                <tr class="totals">
                                                    <td colspan="2"><span>Total accounts activated:</span></td>
                                                    <td><span class="octTotalSum"></span></td>
                                                    <td><span class="novTotalSum"></span></td>
                                                    <td><span class="decTotalSum"></span></td>
                                                    <td><span class="activatedTotalSum"></span></td>
                                                    <td><span class="avgTotalSum"></span></td>
                                                </tr>
                                            </tfoot>
                                        </table>

                                        <div data-empty-category="" style="display: none;" class="card w-100 mt-4">
                                            <p class="h6 text-center py-5">No Data Available</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="growth" role="tabpanel" aria-labelledby="growth-tab">
                            <div class="card border-0 mb-4">
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table" id="dataTable" width="100%" cellspacing="0">
                                            <thead class="bg-beige">
                                                <tr class=" ">
                                                    <th>DRA Code</th>
                                                    <th>DRA Name</th>
                                                    <th>Oct - 22</th>
                                                    <th>Nov - 22</th>
                                                    <th>Dec - 22</th>
                                                    <th>Total Leads</th>
                                                    <th>Average of Quarter</th>
                                                </tr>
                                            </thead>
                                            <tbody class=" " data-growth>
                                            </tbody>
                                            <tfoot class=" ">
                                                <tr class="totals">
                                                    <td colspan="2"><span>Total accounts activated:</span></td>
                                                    <td><span class="octTotalSum"></span></td>
                                                    <td><span class="novTotalSum"></span></td>
                                                    <td><span class="decTotalSum"></span></td>
                                                    <td><span class="activatedTotalSum"></span></td>
                                                    <td><span class="avgTotalSum"></span></td>
                                                </tr>
                                            </tfoot>
                                        </table>

                                        <div data-empty-category="" style="display: none;" class="card w-100 mt-4">
                                            <p class="h6 text-center py-5">No Data Available</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- <p id="pagination-here" class="d-flex justify-content-center"></p> -->

        </div>
        <!-- /.container-fluid -->

    </div>
    <!-- End of Main Content -->

</div>
<!-- End of Content Wrapper -->
{% endblock %}
{% block extra_footer_script %}

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/js/jquery.nice-select.min.js"
    integrity="sha512-NqYds8su6jivy1/WLoW8x1tZMRD7/1ZfhWG/jcRQLOzV1k1rIODCpMgoBnar5QXshKJGV7vi0LXLNXPoFsM5Zg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->

<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/css/dataTables.bootstrap4.min.css" integrity="sha512-PT0RvABaDhDQugEbpNMwgYBCnGCiTZMh9yOzUsJHDgl/dMhD9yjHAwoumnUk3JydV3QTcIkNDuN40CJxik5+WQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/jquery.dataTables.min.js" integrity="sha512-BkpSL20WETFylMrcirBahHfSnY++H2O1W+UnEEO4yNIl+jI2+zowyoGJpbtk6bx97fBXf++WJHSSK2MV4ghPcg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
    $(".main-loader").hide();
    $.ajax({
        type: "GET",
        url: "/api/rm/opportunities/tabs/lead/generation/",
        dataType: "json",
        success: function (response) { 

            if (response.data.data.length == 0) {
                $('[ data-empty-category ]').show();
            } else {
                $.each(response.data.data, function (k, v) {
                    var dra_code = v.dra_code;
                    var dra_name = v.dra_name;
                    var dec_22 = v.dec_22;
                    var nov_22 = v.nov_22;
                    var oct_22 = v.oct_22;
                    var total_lead_generated = v.total_lead_generated;
                    var average_of_quarter = v.average_of_quarter;

                    $("[data-lead-generation]").append(
                        '<tr><td>'+dra_code+'</td><td>'+dra_name+'</td><td class="octTotal">'+oct_22+'</td><td class="novTotal">'+nov_22+'</td><td class="decTotal">'+dec_22+'</td><td class="activatedTotal">'+total_lead_generated+'</td><td class="avgTotal">'+average_of_quarter+'</td></tr>'
                    );

                });
                $(".dataTable-lead").DataTable({
                    order: [[1, "asc"]],
                    bDestroy: true,
                    searching: false
                });
       
            }
        },
        error: function (error) {
            $(".main-loader").hide();
        },
    });

$.ajax({
        type: "GET",
        url: "/api/rm/opportunities/tabs/account/activation/",
        dataType: "json",
        success: function (response) { 

            if (response.data.data.length == 0) {
                $('[ data-empty-category ]').show();
            } else {
                $.each(response.data.data, function (k, v) {
                    var dra_code = v.dra_code;
                    var dra_name = v.dra_name;
                    var dec_22 = v.dec_22;
                    var nov_22 = v.nov_22;
                    var oct_22 = v.oct_22;
                    var total_lead_generated = v.total_account_activated;
                    var average_of_quarter = v.average_of_quarter;

                    $("[data-account]").append(
                        '<tr><td>'+dra_code+'</td><td>'+dra_name+'</td><td class="octTotal">'+oct_22+'</td><td class="novTotal">'+nov_22+'</td><td class="decTotal">'+dec_22+'</td><td class="activatedTotal">'+total_lead_generated+'</td><td class="avgTotal">'+average_of_quarter+'</td></tr>'
                    );

                });
                $(".dataTable-account").DataTable({
                    order: [[1, "asc"]],
                    bDestroy: true,
                    searching: false
                });
            }
        },
        error: function (error) {
            $(".main-loader").hide();
        },
    });

$.ajax({
        type: "GET",
        url: "/api/rm/opportunities/tabs/brokerage/generation/",
        dataType: "json",
        success: function (response) { 

            if (response.data.data.length == 0) {
                $('[ data-empty-category ]').show();
            } else {
                $.each(response.data.data, function (k, v) {
                    var dra_code = v.dra_code;
                    var dra_name = v.dra_name;
                    var dec_22 = v.dec_22;
                    var nov_22 = v.nov_n22;
                    var oct_22 = v.oct_22;
                    var total_lead_generated = v.total_brokerage_generated;
                    var average_of_quarter = v.average_of_quarter;

                    $("[data-brokerage]").append(
                        '<tr><td>'+dra_code+'</td><td>'+dra_name+'</td><td class="octTotal">'+oct_22+'</td><td class="novTotal">'+nov_22+'</td><td class="decTotal">'+dec_22+'</td><td class="activatedTotal">'+total_lead_generated+'</td><td class="avgTotal">'+average_of_quarter+'</td></tr>'
                    );

                });
                $(".dataTable-brokerage").DataTable({
                    order: [[1, "asc"]],
                    bDestroy: true,
                    searching: false
                });
            }
        },
        error: function (error) {
            $(".main-loader").hide();
        },
    });

$.ajax({
        type: "GET",
        url: "/api/rm/opportunities/tabs/downfall/account/activation/",
        dataType: "json",
        success: function (response) { 

            if (response.data.data.length == 0) {
                $('[ data-empty-category ]').show();
            } else {
                $.each(response.data.data, function (k, v) {
                    var dra_code = v.dra_code;
                    var dra_name = v.dra_name;
                    var dec_22 = v.dec_22;
                    var nov_22 = v.nov_22;
                    var oct_22 = v.oct_22;
                    var total_lead_generated = v.total_account_activated;
                    var average_of_quarter = v.average_of_quarter;

                    $("[data-downfall]").append(
                        '<tr><td>'+dra_code+'</td><td>'+dra_name+'</td><td class="octTotal">'+oct_22+'</td><td class="novTotal">'+nov_22+'</td><td class="decTotal">'+dec_22+'</td><td class="activatedTotal">'+total_lead_generated+'</td><td class="avgTotal">'+average_of_quarter+'</td></tr>'
                    );

                });
            }
        },
        error: function (error) {
            $(".main-loader").hide();
        },
    });

$.ajax({
        type: "GET",
        url: "/api/rm/opportunities/tabs/downfall/brokerage/generation/",
        dataType: "json",
        success: function (response) { 
            if (response.data.data.length == 0) {
                $('[ data-empty-category ]').show();
            } else {
                $.each(response.data.data, function (k, v) {
                    var dra_code = v.dra_code;
                    var dra_name = v.dra_name;
                    var dec_22 = v.dec_22;
                    var nov_22 = v.nov_22;
                    var oct_22 = v.oct_22;
                    var total_lead_generated = v.total_brokerage_generated;
                    var average_of_quarter = v.average_of_quarter;

                    $("[data-gross]").append(
                        '<tr><td>'+dra_code+'</td><td>'+dra_name+'</td><td class="octTotal">'+oct_22+'</td><td class="novTotal">'+nov_22+'</td><td class="decTotal">'+dec_22+'</td><td class="activatedTotal">'+total_lead_generated+'</td><td class="avgTotal">'+average_of_quarter+'</td></tr>'
                    );

                });
            }
        },
        error: function (error) {
            $(".main-loader").hide();
        },
    });
$.ajax({
        type: "GET",
        url: "/api/rm/opportunities/tabs/degrowth/leads/",
        dataType: "json",
        success: function (response) { 
            console.log(response);
            if (response.data.data.length == 0) {
                $('[ data-empty-category ]').show();
            } else {
                $.each(response.data.data, function (k, v) {
                    var dra_code = v.dra_code;
                    var dra_name = v.dra_name;
                    var dec_22 = v.dec_22;
                    var nov_22 = v.nov_22;
                    var oct_22 = v.oct_22;
                    var total_lead_generated = v.total_leads;
                    var average_of_quarter = v.average_of_quarter;

                    $("[data-growth]").append(
                        '<tr><td>'+dra_code+'</td><td>'+dra_name+'</td><td class="octTotal">'+oct_22+'</td><td class="novTotal">'+nov_22+'</td><td class="decTotal">'+dec_22+'</td><td class="activatedTotal">'+total_lead_generated+'</td><td class="avgTotal">'+average_of_quarter+'</td></tr>'
                    );

                });
            }
        },
        error: function (error) {
            $(".main-loader").hide();
        },
    });
</script> 
<script>
    function calc_total(){
        var octTotal = 0;
        var novTotal = 0;
        var decTotal = 0;
        var activatedTotal = 0;
        var avgTotal = 0;

        $(".octTotal").each(function(){
            octTotal += parseFloat($(this).text());
        });
        $(".novTotal").each(function(){
            novTotal += parseFloat($(this).text());
        });
        $(".decTotal").each(function(){
            decTotal += parseFloat($(this).text());
        });
        $(".activatedTotal").each(function(){
            activatedTotal += parseFloat($(this).text());
        });
        $(".avgTotal").each(function(){
            avgTotal += parseFloat($(this).text());
        });
    
    $('.octTotalSum').text(octTotal);
    $('.novTotalSum').text(novTotal);
    $('.decTotalSum').text(decTotal);
    $('.activatedTotalSum').text(activatedTotal);
    $('.avgTotalSum').text(avgTotal);
    }
    calc_total();
</script>
{% endblock %}